<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      // WebXR requires https: to work so ensure redirected if needed.
      if (location.hostname !== "localhost" && window.location.protocol === "http:" )
        window.location.protocol = "https:";
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Animals Everywhere</title>
  </head>

  <!-- External Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=BentonSans:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=BentonSans+Book:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <script src="../../starburst-background.js"></script>
  <style>
    .a-enter-vr-button{
      display: none;
    }
    .a-enter-ar-button{
      display: none;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .overlay.hidden {
      display: none;
    }
    .popup-content {
      width: 85%;
      max-width: 550px;
      height: 75%;
      max-height: 650px;
      margin: -10vh auto 0;
      background-color: #FFF5E9;
      border-radius: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .popup-content header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 15px;
      background-color: #FFF5E9;
    }
    .popup-content h1 {
      margin: 0;
      font-family: 'Amatic SC', cursive;
      font-size: 1.8rem;
      color: #333;
    }
     .how-to-play {
       flex: 1;
       padding: 8px 15px 80px 15px;
       display: flex;
       flex-direction: column;
       justify-content: space-between;
       align-items: center;
       gap: 8px;
     }
     .instruction {
       width: 100%;
       margin-bottom: 8px;
       display: flex;
       align-items: center;
       gap: 8px;
     }
     .instruction.reverse {
       flex-direction: row;
     }
     .instruction.reverse .instruction-icon {
       flex-direction: row;
     }
    .instruction-icon {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 4px;
      flex: 1;
      min-width: 0;
    }
     .instruction-image {
       flex-shrink: 0;
       width: 80px;
       height: 80px;
       object-fit: contain;
     }
     .instruction img.number-icon {
       width: 30px;
       height: auto;
     }
    .instruction-text {
      font-size: 0.9rem;
      margin: 0;
      flex: 1;
      word-wrap: break-word;
      line-height: 1.4;
    }
      .instruction img.instruction-image {
        max-width: 100%;
        height: auto;
        max-height: 80px;
        object-fit: contain;
      }
     #howToPlay .popup-content footer {
       position: absolute !important;
       bottom: 24px !important;
       left: 0 !important;
       right: 0 !important;
       width: 100% !important;
       display: flex !important;
       justify-content: center !important;
       align-items: center !important;
       padding: 0 !important;
       margin: 0 !important;
       height: 60px !important;
     }
     
     #howToPlay .popup-content footer .main-button {
       margin: 0 !important;
       transform: none !important;
     }
     
     #howToPlay .popup-content footer .main-button:hover {
       transform: none !important;
     }
     
     #howToPlay .popup-content footer .main-button:active {
       transform: none !important;
     }
     
     #howToPlay .popup-content header {
       padding-top: 24px !important;
     }
     
     #howToPlay .popup-content header h1 {
       color: #3A2E27 !important;
       text-align: center !important;
       -webkit-text-stroke-width: 0.5px !important;
       -webkit-text-stroke-color: #3A2E27 !important;
       font-family: "Amatic SC" !important;
       font-size: 32px !important;
       font-style: normal !important;
       font-weight: 400 !important;
       line-height: 120% !important;
     }
     
     #howToPlay .popup-content {
       border-radius: 24px !important;
       border: 2px solid #E7D4A3 !important;
       background: #FCF6EF !important;
       box-shadow: 0 4px 0 0 #E7D4A3 !important;
     }
    .back-button {
      display: flex;
      align-items: center;
      gap: 10px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'BentonSans Comp Black', sans-serif;
      font-weight: 400;
      font-size: 24px;
      padding: 12px;
      background: #BD3B00;
      color: #FCEFE1;
      box-shadow: 0px 4px 0px 0px #962F00;
      transition: all 0.2s ease;
    }
    .back-button:hover {
      transform: translateY(2px);
      box-shadow: 0px 2px 0px 0px #962F00;
    }
    .back-button:active {
      transform: translateY(4px);
      box-shadow: none;
    }
     .back-button img {
       width: 24px;
       height: 24px;
     }
    .header-placeholder {
      width: 48px;
    }
    .main-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'BentonSans Comp Black', sans-serif;
      font-weight: 400;
      font-size: 24px;
      padding: 12px 24px;
      background: #BD3B00;
      color: #FCEFE1;
      width: 220px;
      box-shadow: 0px 4px 0px 0px #962F00;
      transition: all 0.2s ease;
    }
    .main-button:hover {
      transform: translateY(2px);
      box-shadow: 0px 2px 0px 0px #962F00;
    }
     .main-button:active {
       transform: translateY(4px);
       box-shadow: none;
     }
     .main-button:disabled {
       background: #999;
       color: #ccc;
       box-shadow: 0px 4px 0px 0px #666;
       cursor: not-allowed;
       opacity: 0.6;
     }
     .main-button:disabled:hover {
       transform: none;
       box-shadow: 0px 4px 0px 0px #666;
     }
     .main-button:disabled:active {
       transform: none;
       box-shadow: 0px 4px 0px 0px #666;
     }
     .main-button:not(:disabled) {
       background: #BD3B00;
       color: #FCEFE1;
       box-shadow: 0px 4px 0px 0px #962F00;
       cursor: pointer;
       opacity: 1;
     }
     
     .main-button.button-enabled {
       animation: buttonPulse 0.5s ease-in-out;
     }
     
     @keyframes buttonPulse {
       0% { transform: scale(1); }
       50% { transform: scale(1.05); }
       100% { transform: scale(1); }
     }
    @media (max-height: 700px) {
      .popup-content {
        height: 80%;
        margin: -10vh auto 0;
      }
      .how-to-play {
        gap: 5px;
      }
      .instruction {
        margin-bottom: 4px;
      }
      .instruction img.instruction-image {
        max-height: 80px;
      }
    }

    /* Orientation Warning Overlay */
    .orientation-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .orientation-content {
      background-color: #FCF6EF;
      border: 3px solid #E7D4A3;
      border-radius: 1rem;
      padding: 2rem;
      text-align: center;
      max-width: 300px;
      margin: 1rem;
      box-shadow: 0px 4px 0px 0px #E7D4A3;
    }

    .orientation-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: rotateToPortrait 2.5s ease-in-out infinite;
        transform-origin: 0 100%;
        display: inline-block;
    }

    .orientation-content h2 {
      color: #C14400;
      font-family: "Amatic SC", sans-serif;
      font-weight: 700;
      font-size: 2rem;
      margin: 0 0 1rem 0;
    }

    .orientation-content p {
      color: #333;
      font-size: 1.1rem;
      margin: 0;
      line-height: 1.4;
    }

    @keyframes rotateToPortrait {
        0% { transform: rotate(-90deg); opacity: 1; }
        40% { transform: rotate(0deg); opacity: 1; }
        60% { transform: rotate(0deg); opacity: 1; }
        70% { transform: rotate(0deg); opacity: 0; }
        71% { transform: rotate(-90deg); opacity: 0; }
        80% { transform: rotate(-90deg); opacity: 1; }
        100% { transform: rotate(-90deg); opacity: 1; }
    }

    /* Hidden class for orientation overlay */
    .hidden {
        display: none !important;
    }
  </style>
  <!-- Packages -->
  <script src="ammo.wasm.js"></script>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/IdeaSpaceVR/aframe-particle-system-component@latest/dist/aframe-particle-system-component.min.js"></script>
  
  <!-- Local Components -->
  <script src="photographer.js"></script>
  <script src="physics-utils.js"></script>
  <script src="animation-utils.js"></script>
  <script src="placer.js"></script>

  <!--  Overlay functions  -->
  <script>
    let firstStart = false
    function openHowToPlay() {
      document.querySelector('#click-sfx').emit('startsound')
      document.getElementById('howToPlay').classList.remove('hidden');
      // Hide instructions when opening how-to-play
      hideInstructions();
    }
    
    // Ensure hideInstructions function exists to prevent errors
    function hideInstructions() {
      const instructions = document.querySelector('#instructions');
      if (instructions) {
        instructions.style.opacity = '0';
      }
    }
    
    function showInstructions() {
      const instructions = document.querySelector('#instructions');
      if (instructions) {
        instructions.style.opacity = '1';
      }
    }
    function closeHowToPlay() {
      document.querySelector('#click-sfx').emit('startsound')
      document.getElementById('howToPlay').classList.add('hidden');
      if(!firstStart) {
        startAudio()
        firstStart = true
      }
      // Show instructions after a short delay when closing how-to-play
      setTimeout(showInstructions, 500);
    }
    function backHowToPlay() {
      document.querySelector('#click-sfx').emit('startsound')
      window.top.location.href = '../../menu.html';
    }
    function openCongratulations() {
      // Stop background music - pause direct audio and mute A-Frame sound
      const backgroundAudio = document.getElementById('background-mp3');
      if (backgroundAudio) {
        backgroundAudio.pause();
        backgroundAudio.currentTime = 0;
      }
      
      // Mute the A-Frame background sound instead of stopping it completely
      const backgroundSfx = document.querySelector('#background-sfx');
      if (backgroundSfx && backgroundSfx.components.sound) {
        backgroundSfx.setAttribute('sound', 'volume', 0);
      }
      
      document.getElementById('gamecomplete').classList.remove('hidden')
    }
    function closeCongratulations() {
      document.getElementById('gamecomplete').classList.add('hidden')
      document.querySelector('#click-sfx').emit('startsound')
    }
    
    function showBadgeCollection() {
      // Stop background music - pause direct audio and mute A-Frame sound
      const backgroundAudio = document.getElementById('background-mp3');
      if (backgroundAudio) {
        backgroundAudio.pause();
        backgroundAudio.currentTime = 0;
      }
      
      // Mute the A-Frame background sound instead of stopping it completely
      const backgroundSfx = document.querySelector('#background-sfx');
      if (backgroundSfx && backgroundSfx.components.sound) {
        backgroundSfx.setAttribute('sound', 'volume', 0);
      }
      
      // Add badge to collection
      if (typeof addBadge === 'function') {
        addBadge('photographer');
      } else {
        // Fallback for when badges page isn't loaded
        let collectedBadges = JSON.parse(localStorage.getItem('collectedBadges') || '[]');
        if (!collectedBadges.includes('photographer')) {
          collectedBadges.push('photographer');
          localStorage.setItem('collectedBadges', JSON.stringify(collectedBadges));
        }
      }
      
      // Hide the game complete popup
      document.getElementById('gamecomplete').classList.add('hidden');
      
      // Play TaDA celebration sound
      const tadaAudio = document.getElementById('tada-wav');
      if (tadaAudio) {
        tadaAudio.play().catch(e => console.log('TaDA audio play failed:', e));
      }
      
      // Show the badge splash with congratulations
      const badgeSplash = document.getElementById('badgeSplash');
      badgeSplash.classList.remove('hidden');
      
      // Auto-dismiss splash after 4 seconds and show detail screen
      setTimeout(() => {
        badgeSplash.classList.add('hidden');
        document.getElementById('badgeCollection').classList.remove('hidden');
      }, 4000);
    }

    function restartGame() {
      // Play button tap sound
      document.querySelector('#click-sfx').emit('startsound');
      // Close congratulations popup
      document.getElementById('gamecomplete').classList.add('hidden');
      // Close badge collection
      document.getElementById('badgeCollection').classList.add('hidden');
      
      // Get peacock element
      const peacockEl = document.querySelector('#peacock');
      
      // Reset ar-place component state
      if (peacockEl.components['ar-place']) {
        peacockEl.components['ar-place'].placed = false;
      }
      
      // Reset peacock position and scale to initial values
      peacockEl.setAttribute('position', '0 0 -5');
      peacockEl.setAttribute('scale', '0.6 0.6 0.6');
      peacockEl.setAttribute('visible', false);
      
      // Remove any animations
      peacockEl.removeAttribute('animation__grow');
      peacockEl.removeAttribute('animation__shrink');
      peacockEl.removeAttribute('animation-mixer');
      
      // Reset ar-place to enabled
      peacockEl.setAttribute('ar-place', {
        enabled: true,
        floorID: '#placezone'
      });
      
      // Reset photographersubject component state
      if (peacockEl.components.photographersubject) {
        peacockEl.components.photographersubject.posing = false;
      }
      
      // Reset game state variables
      if (typeof gameStarted !== 'undefined') {
        gameStarted = false;
      }
      if (typeof cameraReady !== 'undefined') {
        cameraReady = false;
      }
      
      // Reset placezone visibility
      document.querySelector('#placezone').setAttribute('visible', true);
      
      // Reset hint text
      document.querySelector('#hint').innerHTML = "Tap the highlighted area to bring out the peacock.";
      
      // Show instructions
      showInstructions();
    }
    
    function goHome() {
      window.top.location.href = '../../badges.html';
    }

    // Add this at the start of your script section
    window.onload = function() {
      // Skip directly to how-to-play like sunflower game
      openHowToPlay();
      setTimeout(() => {
        const button = document.getElementById('closehowto');
        if (button) {
          button.disabled = false;
          button.classList.add('button-enabled');
          console.log('Let\'s go button enabled');
        } else {
          console.error('Button with ID "closehowto" not found');
        }
      }, 5000);
    }

  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XT4SMTQCY2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XT4SMTQCY2');
  </script>
<body>
    <!-- Orientation Warning Overlay -->
    <div id="orientationOverlay" class="orientation-overlay hidden">
      <div class="orientation-content">
        <div class="orientation-icon">ðŸ“±</div>
        <h2>Please Rotate Your Device</h2>
        <p>Hold your device in portrait mode for the best experience</p>
      </div>
    </div>
    
    <!-- How to Play Overlay -->
    <div id="howToPlay" class="overlay hidden">
      <div class="popup-content">
        <header>
          <button class="back-button" onclick="backHowToPlay()">
            <img src="assets/Arrow.png" alt="Back">
          </button>
          <h1>How to Play</h1>
          <div class="header-placeholder"></div>
        </header>

        <main class="how-to-play">
          <!-- Instruction 1 -->
          <div class="instruction">
            <div class="instruction-icon">
              <img src="assets/icon-number.png" alt="Step 1" class="number-icon">
              <p class="instruction-text">Try to snap a perfect photo while theyâ€™re putting on a dazzling display.</p>
            </div>
            <img src="assets/peacock1.png" alt="Peacock in grass" class="instruction-image">
          </div>

          <!-- Instruction 2 (Reversed layout) -->
          <div class="instruction reverse">
            <img src="assets/camera.png" alt="Camera" class="instruction-image">
            <div class="instruction-icon">
              <img src="assets/icon-number-2.png" alt="Step 2" class="number-icon">
              <p class="instruction-text">Tap the button to take a picture.</p>
            </div>
          </div>

          <!-- Instruction 3 -->
          <div class="instruction">
            <div class="instruction-icon">
              <img src="assets/icon-number-3.png" alt="Step 3" class="number-icon">
              <p class="instruction-text">Snap a well centered picture of the peacock while itâ€™s posing for the best possible picture.</p>
            </div>
            <img src="assets/peacock2.png" alt="Peacock Posing" class="instruction-image">
          </div>
        </main>

        <footer>
          <button id="closehowto" class="main-button" onclick="closeHowToPlay()" disabled>Let's Go</button>
        </footer>
      </div>
    </div>

    <!--   Game Complete   -->
    <div id="gamecomplete" class="popupWindow hidden" style="overflow: unset;">
      <div class="starRow">
        <img class="star" src="assets/Star.png">
        <img class="star" src="assets/Star.png">
        <img class="star" src="assets/Star.png">
      </div>
      <div class="popupContent" style="padding: 1rem 0rem 0rem 0rem;">
        <div style="width: 100%">
          <h2 class="amatic-sc-bold" style="margin: 0; font-size: 2.5rem;">Game Complete</h2>
          <hr style="width: 80%; border: none; background-color: #E7D4A3; color: #E7D4A3; height: 1px;">
        </div>
        <p style="font-size: 1.25rem; font-family: 'BentonSans Book', sans-serif;">You did it! A proud peacock moment captured forever.</p>
        <div class="buttonRow">
          <button class="secondaryButton popupButtonSmall" onclick="">
            <img src="assets/Share.png" style="object-fit: contain; width: 2rem;">
          </button>
          <button class="secondaryButton popupButtonSmall" onclick="restartGame()">
            <img src="assets/PlayAgain.png" style="object-fit: contain; width: 2rem;">
          </button>
          <button class="primaryButton popupButtonSmall" onclick="showBadgeCollection()" style="font-family: 'BentonSans', sans-serif;">Continue</button>
        </div>
      </div>
    </div>

    <!-- Badge Congratulations Splash (4s auto-dismiss) -->
    <div id="badgeSplash" class="badge-splash hidden">
      <div class="starburst-background-overlay"></div>
      <div class="splash-content">
        <img src="../../assets/badges/icons/peacock-game-badge.svg" class="splash-badge-icon">
        <h1 class="splash-title">Congratulations</h1>
        <p class="splash-subtitle">You earned a badge!</p>
      </div>
    </div>

    <!-- Badge Collection Detail Screen -->
    <div id="badgeCollection" class="badge-collection hidden">
      <div class="starburst-background-overlay"></div>
      <div class="badge-detail-content">
        <img src="../../assets/badges/icons/peacock-game-badge.svg" class="badge-detail-icon">
        <h2 class="badge-name">Proud Photographer</h2>
        <p class="badge-description">You captured the peacock's proudest moment.</p>
        <button class="primaryButton" onclick="goHome()">Continue</button>
      </div>
    </div>

    <video id="camerafeed" autoplay style="width: 100vw; height: 100vh; object-fit: cover;"></video>
    <canvas id="cameracanvas" style="position: absolute; top: 0; left: 0; opacity: 0.5; display: none;"></canvas>

    <div id="polaroid-container" class="polaroid-container polaroid-above">
      <div id="polaroid" class="polaroid">
        <div class="polaroid-content">
          <div class="polaroid-image">
            <canvas id="outputcanvas" class="polaroid-canvas"></canvas>
          </div>
          <div id="polaroid-note" class="polaroid-note">
            Score: 0
          </div>
        </div>
      </div>
      <div class="polaroid-buttons">
        <button id="retrybutton" class="secondaryButton squareButton" style="max-height: 1rem; width: 4rem;"><img src="assets/PlayAgain.png"></button>
        <button id="okbutton" class="primaryButton" style="min-width: 6rem; font-size: 1.5rem;">Ok!</button>
        <button id="savebutton" class="secondaryButton squareButton" style="max-height: 1rem; width: 4rem;"><img src="assets/Download.png"></button>
      </div>
    </div>

    <div id="darkfilter" class="overlay" style="pointer-events: none; z-index: 999; opacity: 0; transition: opacity 1s ease-in-out;"></div>

    <div id="flashfilter" class="" style="pointer-events: none; z-index: 1000;"></div>
    
    <!-- HTML Overlay -->
    <div id="overlay" style="position: absolute; z-index: 1; ">
      <header>
        <button id="help" class="secondaryButton squareButton" onclick="openHowToPlay()" style="position: absolute; right: 4%; top: 2%; padding: 12px;">
          <img src="assets/Help.png" alt="Help" style="width: 24px; height: 24px; object-fit: contain;">
        </button>
        <p id="hint">Tap the highlighted area to bring out the peacock</p>
      </header>
      <!-- <button id="zoomOutButton" onclick="zoomOutButton()" style="position: absolute; bottom: 1rem; left: 10%; width: 4rem; height: 4rem; font-size: 2rem;">
        -
      </button> -->
      <button id="cameraButton" onclick="cameraButton()" style="position: fixed; bottom: max(8vh, 5.5rem); left: 50%; transform: translateX(-50%); width: 25%; max-width: 120px; min-width: 80px; height: auto; aspect-ratio: 1; background: none; border: none; z-index: 1000;">
        <img src="assets/button-tap.png" alt="Icon for shutter button" style="width: 100%; height: 100%; object-fit: contain;">
      </button>
      <!-- <button id="zoomInButton" onclick="zoomInButton()" style="position: absolute; bottom: 1rem; right: 10%; width: 4rem; height: 4rem; font-size: 2rem;">
        +
      </button> -->
    </div>

    <!-- Aframe Scene -->
    <a-scene id="scene" webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: #overlay;" button-enter-ar="buttonID: #arButton;"
    cursor="rayOrigin: mouse; fuse: false;" raycaster="objects: .raycast;"
    physics=" driver: ammo; debug: false; debugDrawMode: 1; iterations: 100; maxSubSteps: 4; fixedTimeStep: 0.01667"
    renderer="antialias: true; highRefreshRate: true; colorManagement: true; sortObjects: true; logarithmicDepthBuffer: true; 
      physicallyCorrectLights: true; maxCanvasWidth: 1920; maxCanvasHeight: 1920; foveationLevel: 0;"
    gltf-model="dracoDecoderPath: https://cdn.jsdelivr.net/npm/three@0.129.0/examples/js/libs/draco/gltf/;"
    background="transparent: true;">
      
      <!-- Assets -->
      <a-assets>
        <a-asset-item
          id="peacock-glb"
          src="assets/Peacock.glb"
        ></a-asset-item>
        
        <audio id="click-mp3" src="assets/audio/click.mp3" autostart="0" preload ="none"></audio>
        <audio id="bling-mp3" src="assets/audio/bling.mp3" autostart="0" preload ="none"></audio>

        <audio id="ding-wav" src="assets/audio/ding.wav" autostart="0" preload ="none"></audio>
        <audio id="ding2-wav" src="assets/audio/ding2.wav" autostart="0" preload ="none"></audio>
        <audio id="tada-wav" src="assets/audio/tada.mp3" autostart="0" preload ="none"></audio>

        <!-- <img id="texture" src="https://cdn.glitch.global/8edb8ccc-1d3b-4b5f-b3c1-4b7d8d39f2fb/WaterPour_texture.png?v=1739875301530"> -->
      </a-assets>

      <!-- Camera -->
      <a-entity id="camera" position="0 1.15 0" rotation="0 0 0" camera="zoom: 1;" look-controls="magicWindowTrackingEnabled: true; touchEnabled: false;"
        photographergamecamera="sceneID: #scene;">
          <!--     Place objects attached to camera here     -->
      </a-entity>
      
      <!-- Light & Sound -->
      <a-entity light="type: ambient; color: #fff; intensity: 2;"></a-entity>

      <a-entity id="click-sfx" sound="src: #click-mp3; on: startsound; loop: false; volume: 2;"></a-entity>
      <a-entity id="tada-sfx" sound="src: #tada-wav; on: startsound; loop: false; volume: 1;"></a-entity>
      
      <!-- Scene contents -->
      <a-entity id="floor" position="0 -0.5 0" geometry="primitive: cylinder; radius: 50; height: 1;" visible="false" grip="0.9" material="color: lime;"
        ammo-body="type: static;" ammo-shape="type: cylinder;"></a-entity>
      <a-ring id="placezone" class="raycast" position="0 0 0" rotation="-90 0 0" material="color: green; transparent: true; opacity: 0.5;" 
        radius-inner="1.75" radius-outer="4"></a-ring>
      
      <a-entity id="peacock" gltf-model="#peacock-glb" position="0 0 -5" scale="0.6 0.6 0.6" ar-place="floorID: #placezone;"
        photographersubject animation-events="events: placed; animations: *; loops: repeat;"></a-entity>
      
    </a-scene>
  </body>

  <script src="main.js"></script>
  <script>
    // Initialize starburst backgrounds in overlays
    function initStarburstOverlay(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        const overlay = container.querySelector('.starburst-background-overlay');
        if (overlay && !overlay.querySelector('img')) {
          const img = document.createElement('img');
          img.src = '../../assets/Startburst.svg';
          img.alt = 'Starburst background';
          overlay.appendChild(img);
        }
      }
    }
    
    // Initialize when overlays are shown
    const observer = new MutationObserver(() => {
      initStarburstOverlay('badgeSplash');
      initStarburstOverlay('badgeCollection');
    });
    
    observer.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['class'] });
    
    // Initial check
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        initStarburstOverlay('badgeSplash');
        initStarburstOverlay('badgeCollection');
      });
    } else {
      initStarburstOverlay('badgeSplash');
      initStarburstOverlay('badgeCollection');
    }
  </script>
</html>